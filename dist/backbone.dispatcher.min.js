!function(e,t){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(n,i){return e.Backbone.Dispatcher=t(n,i)}):"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):e.Backbone.Dispatcher=t(e.Backbone,e._)}(this,function(e,t){"use strict";var n=function(n){n&&n.actions&&("string"==typeof n.actions?this.createAction(n.actions):this.createActions(n.actions)),Object.defineProperty(this,"_actions",{enumerable:!1,value:{}}),t.extend(this._actions,e.Events),this.initialize.apply(this,arguments)};return n.extend=e.Model.extend,n.VERSION="0.0.8",n.prototype={initialize:function(){},_prepareAction:function(e,n){var i={};if(t.isString(e)){if(i.name=e,n)if(t.isFunction(n))i.beforeEmit=n;else for(var r in n)n.hasOwnProperty(r)&&(i[r]=n[r])}else i=e;return i},createAction:function(e,t){var n,i=this._prepareAction(e,t),r=function(e){this._triggerAction(i.name,e)}.bind(this),o=function(e){i.beforeEmit(e,function(e){r(e)})},c=function(e){return function(t){i.shouldEmit(t)&&e(t)}};n=i.shouldEmit?c(i.beforeEmit?o:r):i.beforeEmit?o:r,Object.defineProperty(this,i.name,{enumerable:!1,value:n})},createActions:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.createAction(e[t])},register:function(e,t,n){if(!t)throw new Error("The listener is undefined!");if(n="function"==typeof n?n:t[n||e],"function"!=typeof n)throw new Error("Cannot register callback `"+n+"` for the action `"+e+"`: the method is undefined on the provided listener object!");this._actions.on(e,n.bind(t))},registerStore:function(e,n,i){var r,o="string"==typeof i||"function"==typeof i;if(t.isArray(e)){if(i=i||e,!o&&e.length!==i.length)throw new RangeError("The # of callbacks differs from the # of action names!")}else t.isObject(e)&&(r=Object.keys(e),i=r.map(function(t){return e[t]}),e=r);for(var c,s=0;c=e[s];s++)this.register(c,n,o?i:i[s])},dispatch:function(e,t){if(this.hasOwnProperty(e))return this[e](t);throw new Error("There is not an action called `"+e+"`")},_triggerAction:function(e,t){this._actions.trigger(e,t)}},n});